{% extends 'base.html' %} {% block content %}
<h1>{{ house.title }}</h1>
<div class="house-listing">
  <div class="d-flex gallery">
    {% for image in house.images %}
    <div class="gallery-item">
      <img
        src="/{{ image.filename }}"
        alt="House Image"
        class="gallery-image border"
      />
      <a href="/{{ image.filename }}" alt="House Image" target="_blank"
        >Open Image</a
      >
    </div>
    {% endfor %}
  </div>
  <p><strong>Price:</strong> {{ house.price }} Birr</p>
  <p><strong>Location:</strong> {{ house.location }}</p>
  <p><strong>Number of Rooms:</strong> {{ house.number_of_rooms }}</p>
  <p><strong>Amenities:</strong> {{ house.amenities }}</p>
  <p><strong>Contact:</strong> {{ house.contact }}</p>
  <a
    href="{{ url_for('add_to_wishlist', listing_id=house.id) }}"
    class="btn btn-outline-info"
    ><i class="far fa-heart"></i> Wishlist</a
  >
  <form
    method="DELETE"
    action="{{ url_for('delete_listing', listing_id=house.id) }}"
    style="display: inline-block"
  >
    <button
      type="submit"
      class="btn btn-danger"
      onclick="return confirm('Are you sure you want to delete this listing?')"
    >
      Delete
    </button>
  </form>
  <a href="{{ url_for('edit_listing', id=house.id) }}" class="btn btn-primary"
    >Edit</a
  >
  <!-- Map container -->
  <div id="map"></div>
</div>
<!-- Leaflet JS from CDN -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  fetch("https://nominatim.openstreetmap.org/search?format=json&q={{ house.location }}+Addis+Ababa")
    .then((response) => response.json())
    .then((data) => {
      if (data && data.length > 0) {
        const lat = data[0].lat;
        const lon = data[0].lon;
        console.log("Latitude:", lat, "Longitude:", lon);
        var zoom = 13;
        var map = L.map("map").setView([lat, lon], zoom);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution:
            'Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors',
        }).addTo(map);
        L.marker([lat, lon]).addTo(map).bindPopup("{{house.location}}").openPopup();
      }
    })
    .catch((error) => console.error("Error:", error));
</script>
{% endblock %}
